
//Code : 
//Pluto laser game
//DronaAviationPvtLtd
//Apurva Donde
#include "PlutoPilot.h"
#include"Control.h" 
#include "User.h"
#include "Motor.h"
#include "Utils.h"
#include "Estimate.h"
#include "Peripheral.h"
#include "Control.h"
#include "Sensor.h"
#include "stdio.h"

int LaserReceiver;
int32_t var=0;
int16_t flag=0;
int16_t flag2=0;
bool TRUE;
//The setup function is called once a PlutoX's hardware startup

void plutoInit()
{
//Add your hardware initialization code here
GPIO.init(Pin10, INPUT);  //initializing Pin10

}


//The function is called once before plutoloop() when you activate developer mode

void onLoopStart()
{
//Do your one time stuff here
	LED.flightStatus(DEACTIVATE);

setUserLoopFrequency(100);
}

//The loop function is called in an endless loop

void plutoLoop()
{
//Add your repeated code here

LaserReceiver=GPIO.read(Pin10); //Reading the data from Pin10 
Monitor.println("LaserReceiver", LaserReceiver); //Printing the data 


//Adding timer for safe landing
if (flag==0 )
{
	if(LaserReceiver==0)
	{
		flag=1;

		LED.set(BLUE, TOGGLE);
		Monitor.println("Land");
	}
}

	if(flag==1)
	{

		LED.set(GREEN, TOGGLE);

		Monitor.println("Throttle_low");
		RcCommand.set(RC_THROTTLE, 1000);
		var=var+1;
		Monitor.println("Count",var);
		if(var>20){
			Command.disArm();
						Monitor.println("Land");
						flag=2;
						flag2=2;
			Monitor.println("Count reach");
	      }

	}

}


//The function is called once after plutoloop() when you deactivate developer mode

void onLoopFinish()
{
//Do your cleanup stuff here
	flag=0;
	var=0;
	flag2=0;
LED.flightStatus(ACTIVATE);
}

